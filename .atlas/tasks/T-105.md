---
id: "T-105"
type: "task"
status: "done"
priority: "high"
parent_spec: "003-tasks_tickets.md"
---

# Implement Backend API for Tasks/Tickets

This task implements the CRUD API endpoints for managing task/ticket files in the `.atlas/tasks/` directory, including YAML frontmatter parsing and generation.

## Sub-tasks:

- [x] **Install YAML Parsing Dependency:**
    - Add a YAML parsing library (e.g., `yaml` or `gray-matter`) using `bun add`.
    - Alternatively, implement simple frontmatter parsing if dependencies should be minimal.

- [x] **Define Zod Validation Schemas:**
    - Create schema for task ID (format: `T-XXX`).
    - Create schema for task metadata:
        - `id`: string, required
        - `type`: literal "task"
        - `status`: enum ("todo", "in-progress", "done")
        - `priority`: enum ("low", "medium", "high")
        - `parent_spec`: string, optional
    - Create schema for task content (markdown string).

- [x] **Implement Frontmatter Parsing Helper:**
    - Create a utility function to parse markdown files with YAML frontmatter.
    - Extract metadata object and content body separately.
    - Handle malformed frontmatter gracefully.

- [x] **Implement Frontmatter Generation Helper:**
    - Create a utility function to serialize task metadata and content back to markdown with YAML frontmatter.
    - Ensure proper `---` delimiters.

- [x] **Implement `GET /api/tasks` Endpoint:**
    - Read all files from `.atlas/tasks/` directory.
    - Parse each file's frontmatter and content.
    - Return a JSON array of task objects with metadata and content.
    - Handle case where directory doesn't exist.

- [x] **Implement `GET /api/tasks/{task_id}` Endpoint:**
    - Validate the `task_id` path parameter.
    - Read and parse `.atlas/tasks/{task_id}.md`.
    - Return task object with metadata and content.
    - Return 404 if task doesn't exist.

- [x] **Implement `POST /api/tasks` Endpoint:**
    - Validate request body against task schema.
    - Generate markdown file with YAML frontmatter.
    - Write to `.atlas/tasks/{task_id}.md`.
    - Return the created task object.

- [x] **Implement `PUT /api/tasks/{task_id}` Endpoint:**
    - Validate `task_id` path parameter.
    - Validate request body against task schema.
    - Update the existing task file.
    - Return 404 if task doesn't exist.
    - Return the updated task object.

- [x] **Implement `DELETE /api/tasks/{task_id}` Endpoint:**
    - Validate the `task_id` path parameter.
    - Delete `.atlas/tasks/{task_id}.md`.
    - Return 404 if task doesn't exist.
    - Return success response on deletion.

- [x] **Add Security Validations:**
    - Validate task ID format strictly.

- [x] **Write Unit Tests:**
    - Test listing all tasks returns parsed objects.
    - Test getting a single task by ID.
    - Test creating a new task with auto-generated ID.
    - Test updating task metadata (e.g., changing status).
    - Test updating task content.
    - Test deleting a task.
    - Test frontmatter parsing edge cases.
    - Test error cases (404, invalid data, malformed frontmatter).
